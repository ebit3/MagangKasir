<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Dashboard Kasir</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

        <link rel="stylesheet" href="../assets/dist/css/index.css">

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    </head>

    <body>

        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg navbar-dark">
            <div class="container">
                <a class="navbar-brand" href="../index.html">Muji Perkasa</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="../index.html">Beranda</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="../user/home.html">Pengguna</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="../produk/home.html">Produk</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="../kategori/home.html">Kategori</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="home.html" aria-current="page">Transaksi</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">Laporan</a>
                        </li>
                    </ul>
                    <form class="d-flex">
                        <!-- Tombol Logout -->
                        <button id="logoutBtn" class="btn btn-danger btn-sm">
                            <i class="bi bi-arrow-right-square"></i>
                        </button>
                    </form>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <div class="container mt-5">
            <div class="row text-center">
                <h1>Transaksi</h1>
            </div>

            <div class="row mt-4 justify-content-center">
                <div class="col-md-12 col-lg-12 mb-4">
                    <form action="" method="post">
                        <div class="card">
                            <div class="card-body">
                                <div class="row align-items-end">
                                    <!-- Input Produk -->
                                    <div class="col-md-5">
                                        <div class="mb-3">
                                            <label for="produk" class="form-label">Nama Produk</label>
                                            <select name="produk" id="produk" class="form-select">
                                                <option selected>Pilih Produk...</option>
                                                <option value="3000">Produk 1 (Rp 3.000)</option>
                                                <option value="9000">Produk 2 (Rp 9.000)</option>
                                                <option value="2000">Produk 3 (Rp 2.000)</option>
                                            </select>
                                        </div>
                                    </div>

                                    <!-- Input Quantity -->
                                    <div class="col-md-5">
                                        <div class="mb-3">
                                            <label for="qty" class="form-label">Jumlah Barang</label>
                                            <input type="number" name="qty" id="qty" class="form-control" required
                                                placeholder="Masukkan jumlah barang">
                                        </div>
                                    </div>

                                    <!-- Tombol Submit -->
                                    <div class="col-md-2">
                                        <div class="mb-3">
                                            <button class="btn btn-primary fw-semibold w-100" type="submit"
                                                name="submit">
                                                <i class="bi bi-bag-fill me-2"></i>
                                                Tambah
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Cart Table -->
                <div class="col-md-7 col-lg-7 mb-4">
                    <div class="card">
                        <div class="card-header bg-primary p-3 text-white">
                            Keranjang Belanja
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table caption-top align-middle">
                                    <caption class="text-start fw-bold">Keranjang Belanja Anda</caption>
                                    <thead>
                                        <tr>
                                            <th scope="col">Barang</th>
                                            <th scope="col">Harga</th>
                                            <th scope="col">Jumlah</th>
                                            <th scope="col">Subtotal</th>
                                            <th scope="col">Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Isi keranjang akan dirender di sini -->
                                    </tbody>
                                    <tfoot>
                                        <tr>
                                            <td colspan="3" class="text-end fw-bold">Total</td>
                                            <td colspan="2" class="fw-bold" id="totalBelanja">Rp 0</td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Detail Belanja -->
                <div class="col-md-5 col-lg-5 mb-4">
                    <div class="card">
                        <div class="card-header bg-primary p-3 text-white">
                            Detail Belanja
                        </div>
                        <div class="card-body">
                            <!-- Kode Belanja -->
                            <div class="mb-3">
                                <label for="kodeBelanja" class="form-label">Kode Belanja</label>
                                <input type="text" name="kode" id="kodeBelanja" class="form-control" value="xysjsm"
                                    disabled>
                            </div>

                            <!-- Tanggal Belanja -->
                            <div class="mb-3">
                                <label for="tglBelanja" class="form-label">Tanggal Belanja</label>
                                <input type="date" name="tgl" id="tglBelanja" class="form-control" value="2024-09-05"
                                    disabled>
                            </div>

                            <!-- Tombol untuk menambah diskon -->
                            <div class="mb-3">
                                <button id="btnTambahDiskon" class="btn btn-outline-primary btn-sm">Tambahkan
                                    Diskon</button>
                            </div>

                            <!-- Input Form Diskon (tersembunyi secara default) -->
                            <div id="formDiskon" class="mb-3" style="display: none;">
                                <label for="diskon" class="form-label">Diskon (%)</label>
                                <input type="number" name="diskon" id="diskon" class="form-control"
                                    placeholder="Masukkan diskon">
                            </div>

                            <!-- Total Belanja -->
                            <div class="mb-3">
                                <label for="totalBelanjaInput" class="form-label">Total Belanja</label>
                                <input type="text" name="total" id="totalBelanjaInput" class="form-control" value="0"
                                    disabled>
                            </div>

                            <!-- Jumlah Uang -->
                            <div class="mb-3">
                                <label for="jumlahUang" class="form-label">Jumlah Uang</label>
                                <input type="text" name="jumlahUang" id="jumlahUang" class="form-control" value="0">
                            </div>

                            <!-- Kembalian -->
                            <div class="mb-3">
                                <label for="kembalianBelanja" class="form-label">Kembalian Belanja</label>
                                <input type="text" name="kembalian" id="kembalianBelanja" class="form-control" value="0"
                                    disabled>
                            </div>

                            <!-- Tombol Selesai Belanja -->
                            <div class="d-grid">
                                <button class="btn btn-primary">Selesai Belanja</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer>
            <p>&copy; 2024 Muji Perkasa. All Rights Reserved.</p>
        </footer>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

        <script type="module">

            // Inisialisasi variabel untuk menampung keranjang belanja
            let cart = [];

            // Fungsi untuk memuat data keranjang dari localStorage
            function loadCart() {
                const storedCart = localStorage.getItem('cart');
                if (storedCart) {
                    cart = JSON.parse(storedCart);
                    renderCart();
                }
            }

            // Fungsi untuk menyimpan keranjang ke localStorage
            function saveCart() {
                localStorage.setItem('cart', JSON.stringify(cart));
            }

            // Fungsi untuk menampilkan keranjang belanja di tabel
            function renderCart() {
                const tableBody = document.querySelector('tbody');
                tableBody.innerHTML = ''; // Kosongkan isi tabel sebelum di-render ulang
                let total = 0;

                cart.forEach((item, index) => {
                    const subtotal = item.harga * item.qty;
                    total += subtotal;

                    const row = `
                    <tr>
                        <td>${item.nama}</td>
                        <td>Rp ${item.harga.toLocaleString()}</td>
                        <td>${item.qty}</td>
                        <td>Rp ${subtotal.toLocaleString()}</td>
                        <td>
                            <button class="btn btn-sm btn-danger" onclick="removeItem(${index})">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
                    tableBody.insertAdjacentHTML('beforeend', row);
                });

                // Update total belanja di bagian detail belanja
                document.getElementById('totalBelanja').textContent = `Rp ${total.toLocaleString()}`;
                document.getElementById('totalBelanjaInput').value = total.toLocaleString();
                calculateChange(); // Hitung kembalian
            }

            // Fungsi untuk menambah produk ke keranjang
            document.querySelector('form').addEventListener('submit', function (e) {
                e.preventDefault();

                const produkSelect = document.getElementById('produk');
                const qtyInput = document.getElementById('qty');

                const produkNama = produkSelect.options[produkSelect.selectedIndex].text;
                const produkHarga = parseInt(produkSelect.value);
                const qty = parseInt(qtyInput.value);

                // Cek jika qty lebih dari 0
                if (qty > 0) {
                    const newItem = {
                        nama: produkNama,
                        harga: produkHarga,
                        qty: qty
                    };
                    cart.push(newItem); // Tambahkan ke keranjang
                    saveCart(); // Simpan keranjang ke localStorage
                    renderCart(); // Render ulang keranjang
                }

                // Reset form
                produkSelect.selectedIndex = 0;
                qtyInput.value = '';
            });

            // Fungsi untuk menghapus item dari keranjang
            function removeItem(index) {
                cart.splice(index, 1); // Hapus item berdasarkan index
                saveCart(); // Simpan perubahan ke localStorage
                renderCart(); // Render ulang keranjang
            }

            // Fungsi untuk menghitung kembalian
            document.getElementById('jumlahUang').addEventListener('input', calculateChange);
            function calculateChange() {
                const totalBelanja = parseInt(document.getElementById('totalBelanjaInput').value.replace(/\./g, '')) || 0;
                const jumlahUang = parseInt(document.getElementById('jumlahUang').value) || 0;
                const kembalian = jumlahUang - totalBelanja;
                document.getElementById('kembalianBelanja').value = kembalian > 0 ? kembalian.toLocaleString() : '0';
            }

            // Fungsi untuk menampilkan/menyembunyikan form diskon
            document.getElementById('btnTambahDiskon').addEventListener('click', function () {
                const formDiskon = document.getElementById('formDiskon');
                if (formDiskon.style.display === 'none') {
                    formDiskon.style.display = 'block';
                } else {
                    formDiskon.style.display = 'none';
                }
            });

            // Muat keranjang dari localStorage saat halaman dimuat
            loadCart();

            // Check if user is logged in
            const loggedInUser = sessionStorage.getItem('loggedInUser');

            if (!loggedInUser) {
                // Redirect to login page if not logged in
                window.location.href = '../auth/login.html';  // Replace with your actual login page URL
            } else {
                const user = JSON.parse(loggedInUser);
                console.log('Logged in as:', user.username);
                // You can display user info or perform other actions
            }

            // Logout function
            function logout() {
                // Remove the session storage data
                sessionStorage.removeItem('loggedInUser');
                // Redirect to the login page
                window.location.href = '../auth/login.html';  // Replace with your actual login page URL
            }

            // Attach the logout function to the button click event
            document.getElementById('logoutBtn').addEventListener('click', logout);

        </script>

    </body>

</html>